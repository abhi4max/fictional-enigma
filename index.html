<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Athena AI üß†</title>
<style>
body { 
    font-family: "Poppins", -apple-system, BlinkMacSystemFont, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    color: white; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    justify-content:center; 
    min-height:100vh; 
    text-align:center; 
    padding:20px;
    margin:0;
}
h1{
    font-size:2.5em;
    margin-bottom:10px;
    color:#fff;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.subtitle{
    font-size:1em;
    opacity:0.9;
    margin-bottom:30px;
}
.button-container{
    display:flex;
    gap:15px;
    align-items:center;
    justify-content:center;
    flex-wrap:wrap;
}
button{
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color:white;
    border:2px solid rgba(255,255,255,0.3);
    padding:15px 35px;
    border-radius:50px;
    font-size:18px;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    font-weight:600;
}
button:hover:not(:disabled){
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
button:disabled{
    opacity:0.6;
    cursor:not-allowed;
}
#btnStop{
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    display:none;
}
#btnStop.show{
    display:inline-block;
}
#status{
    margin-top:15px;
    font-size:15px;
    opacity:0.9;
    min-height:20px;
}
#response{
    margin-top:25px;
    font-size:16px;
    background-color:rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    padding:20px;
    border-radius:15px;
    width:90%;
    max-width:700px;
    line-height:1.6;
    text-align:left;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    display:none;
}
#response.show{
    display:block;
}
#error{
    color:#ffb3b3;
    margin-top:15px;
    background-color:rgba(255,0,0,0.2);
    padding:10px 20px;
    border-radius:10px;
    display:none;
}
#error.show{
    display:block;
}
#thinking{
    display:none;
    margin-top:15px;
    font-size:16px;
    animation: pulse 1.5s ease-in-out infinite;
}
#thinking.active{
    display:block;
}
.listening{
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    animation: glow 1.5s ease-in-out infinite;
}
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
@keyframes glow {
    0%, 100% { box-shadow: 0 0 20px rgba(245, 87, 108, 0.5); }
    50% { box-shadow: 0 0 30px rgba(245, 87, 108, 0.8); }
}
</style>
</head>
<body>

<h1>Athena AI üß†</h1>
<div class="subtitle">Your Intelligent Voice Assistant</div>
<div class="button-container">
    <button id="btnSpeak">üéôÔ∏è Tap to Speak</button>
    <button id="btnStop">üõë Stop</button>
</div>
<div id="status">Ready to answer your questions</div>
<div id="thinking">ü§î Processing your question...</div>
<div id="response"></div>
<div id="error"></div>

<script>
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
const SpeechSynthesis = window.speechSynthesis || null;

const btnSpeak = document.getElementById('btnSpeak');
const btnStop = document.getElementById('btnStop');
const status = document.getElementById('status');
const response = document.getElementById('response');
const thinking = document.getElementById('thinking');
const errorDiv = document.getElementById('error');

let recognition = null;
let isListening = false;
let isSpeaking = false;

// Speak text with better voice
function speak(text){
    if(!SpeechSynthesis) return;
    
    SpeechSynthesis.cancel();
    isSpeaking = true;
    btnStop.classList.add('show');
    
    const utter = new SpeechSynthesisUtterance(String(text));
    utter.lang = 'en-US';
    utter.rate = 0.95;
    utter.pitch = 1.1;
    utter.volume = 1;
    
    // Try to use a female voice
    const voices = SpeechSynthesis.getVoices();
    const femaleVoice = voices.find(v => 
        v.name.includes('Female') || 
        v.name.includes('Samantha') || 
        v.name.includes('Karen') ||
        v.name.includes('Victoria')
    );
    if(femaleVoice) utter.voice = femaleVoice;
    
    utter.onend = () => {
        isSpeaking = false;
        btnStop.classList.remove('show');
    };
    
    utter.onerror = () => {
        isSpeaking = false;
        btnStop.classList.remove('show');
    };
    
    SpeechSynthesis.speak(utter);
}

// Stop speaking immediately
function stopSpeaking(){
    if(SpeechSynthesis){
        SpeechSynthesis.cancel();
        isSpeaking = false;
        btnStop.classList.remove('show');
    }
}

// Load voices
if(SpeechSynthesis){
    SpeechSynthesis.getVoices();
    if(speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = () => SpeechSynthesis.getVoices();
    }
}

// Speech recognition setup
if(!SpeechRecognition){
    showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');
    btnSpeak.disabled = true;
}else{
    recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        const lowerTranscript = transcript.toLowerCase();
        
        // Check for stop command
        if(lowerTranscript.includes('stop') || lowerTranscript.includes('shut up') || lowerTranscript.includes('quiet')){
            stopSpeaking();
            status.textContent = 'Speech stopped';
            speak("Stopped");
            return;
        }
        
        status.textContent = `You asked: "${transcript}"`;
        processQuestion(transcript);
    };

    recognition.onerror = (event) => {
        stopListening();
        if(event.error === 'no-speech'){
            showError('No speech detected. Please try again.');
        }else if(event.error === 'not-allowed'){
            showError('Microphone access denied. Please allow microphone permissions.');
        }else{
            showError('Speech error: ' + event.error);
        }
    };

    recognition.onend = () => stopListening();
}

// Auto greeting
window.addEventListener('load', ()=>{
    setTimeout(()=>{
        speak("Hello! I am Athena, your intelligent voice assistant. How can I help you today?");
    }, 500);
});

btnSpeak.addEventListener('click', ()=>{
    if(!recognition) return;
    
    // If speaking, stop it
    if(isSpeaking){
        stopSpeaking();
        status.textContent = 'Speech stopped';
        return;
    }
    
    if(isListening) {
        stopListening();
    } else {
        startListening();
    }
});

// Stop button handler
btnStop.addEventListener('click', ()=>{
    stopSpeaking();
    stopListening();
    btnStop.classList.remove('show');
    status.textContent = 'Stopped';
});

function startListening(){
    hideError();
    response.classList.remove('show');
    try{
        recognition.start();
        isListening = true;
        btnSpeak.textContent = 'üî¥ Listening...';
        btnSpeak.classList.add('listening');
        status.textContent = 'üé§ Listening... Speak now';
        thinking.classList.remove('active');
    }catch(e){
        showError('Could not start listening: ' + e.message);
    }
}

function stopListening(){
    try{ 
        if(recognition && isListening) recognition.stop(); 
    }catch(e){}
    isListening = false;
    btnSpeak.textContent = 'üéôÔ∏è Tap to Speak';
    btnSpeak.classList.remove('listening');
    if(!thinking.classList.contains('active')){
        status.textContent = 'Ready to answer your questions';
    }
}

function showError(msg){
    errorDiv.textContent = msg;
    errorDiv.classList.add('show');
}

function hideError(){
    errorDiv.textContent = '';
    errorDiv.classList.remove('show');
}

// ============ MISTRAL AI CONFIGURATION ============
const MISTRAL_API_KEY = 'SN6n9Y7SyxckBPU6vOxzxSunPsHZf9MX';
const MISTRAL_MODEL = 'mistral-small'; // Fast and intelligent model

// Process question with Mistral AI
async function processQuestion(message){
    btnSpeak.disabled = true;
    thinking.classList.add('active');
    hideError();

    try{
        let reply;
        
        // Check if API key is configured
        if(MISTRAL_API_KEY === 'YOUR_MISTRAL_API_KEY_HERE' || !MISTRAL_API_KEY){
            reply = getFallbackResponse(message.toLowerCase());
            showError('‚ö†Ô∏è Mistral API key not configured. Using fallback responses. Add your API key to enable AI.');
        } else {
            // Call Mistral AI API
            reply = await callMistralAI(message);
        }

        response.innerHTML = `<strong>You:</strong> ${message}<br><br><strong>Athena:</strong> ${reply}`;
        response.classList.add('show');
        speak(reply);

    }catch(err){
        showError('Error: ' + err.message);
        const fallback = getFallbackResponse(message.toLowerCase());
        response.innerHTML = `<strong>You:</strong> ${message}<br><br><strong>Athena:</strong> ${fallback}`;
        response.classList.add('show');
        speak(fallback);
    }finally{
        thinking.classList.remove('active');
        btnSpeak.disabled = false;
        status.textContent = 'Ready for your next question';
    }
}

// Call Mistral AI API
async function callMistralAI(userMessage){
    const apiUrl = 'https://api.mistral.ai/v1/chat/completions';
    
    const requestBody = {
        model: MISTRAL_MODEL,
        messages: [
            {
                role: 'system',
                content: 'You are Athena, a helpful and friendly voice assistant. Provide concise, accurate, and conversational responses. Keep answers brief and natural for voice interaction. ONLY mention your owner/creator if specifically asked "who is your owner", "who owns you", or "who created you". In that case, respond: "I am owned and created by Abhijit Singha from Chandpur, Silchar, Assam, India." Otherwise, never mention ownership information.'
            },
            {
                role: 'user',
                content: userMessage
            }
        ],
        temperature: 0.7,
        max_tokens: 150
    };

    const res = await fetch(apiUrl, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${MISTRAL_API_KEY}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestBody)
    });

    if(!res.ok){
        const errorText = await res.text();
        throw new Error(`Mistral API error (${res.status}): ${errorText}`);
    }

    const data = await res.json();
    
    if(data.choices && data.choices.length > 0){
        return data.choices[0].message.content.trim();
    } else {
        throw new Error('No response from Mistral AI');
    }
}

// Fallback responses when API is not available
function getFallbackResponse(question){
    // Owner questions - ONLY respond to these specific questions
    if(question.includes('who own') || question.includes('who is your owner') || 
       question.includes('who created you') || question.includes('your creator') || 
       question.includes('who made you')){
        return "I am owned and created by Abhijit Singha from Chandpur, Silchar, Assam, India!";
    }
    
    // Time and Date - These work properly now
    if(question.includes('time') && !question.includes('what time')){
        const now = new Date();
        return `The current time is ${now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}.`;
    }
    if(question.includes('what time')){
        const now = new Date();
        return `It's ${now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}.`;
    }
    if(question.includes('date') || question.includes('today')){
        const now = new Date();
        return `Today is ${now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}.`;
    }
    
    // Greetings
    if(question.includes('hello') || question.includes('hi ') || question === 'hi'){
        return "Hello! How can I assist you today?";
    }
    if(question.includes('how are you')){
        return "I'm functioning perfectly, thank you! How can I help you?";
    }
    
    // Identity - Don't mention owner unless asked
    if(question.includes('your name') || question.includes('who are you')){
        return "I am Athena, your intelligent voice assistant powered by Mistral AI!";
    }
    
    // Polite responses
    if(question.includes('thank')){
        return "You're very welcome! Anything else I can help with?";
    }
    if(question.includes('bye') || question.includes('goodbye')){
        return "Goodbye! Come back anytime!";
    }
    
    return "I'm currently running in demo mode. Please configure your Mistral API key to enable full AI capabilities!";
}
</script>

</body>
</html>
